<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.7">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; -webkit-text-stroke: #000000}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p3 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px 'Helvetica Neue'; -webkit-text-stroke: #000000; min-height: 15.0px}
    span.s1 {font-kerning: none}
    span.s2 {font: 12.0px Times; font-kerning: none}
    span.s3 {font: 13.0px Courier; font-kerning: none}
  </style>
</head>
<body>
<p class="p1"><span class="s1">&lt;!DOCTYPE html&gt;</span></p>
<p class="p1"><span class="s1">&lt;html lang="es"&gt;</span></p>
<p class="p1"><span class="s1">&lt;head&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta charset="UTF-8"&gt;</span></p>
<p class="p1"><span class="s1">&lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;</span></p>
<p class="p1"><span class="s1">&lt;title&gt;Gasolineras y Cargadores - Espa√±a&lt;/title&gt;</span></p>
<p class="p1"><span class="s1">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css"/&gt;</span></p>
<p class="p1"><span class="s1">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.min.css"/&gt;</span></p>
<p class="p1"><span class="s1">&lt;link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/MarkerCluster.Default.min.css"/&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.markercluster/1.5.3/leaflet.markercluster.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://unpkg.com/react@18/umd/react.production.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://unpkg.com/@babel/standalone/babel.min.js"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;script src="https://cdn.tailwindcss.com"&gt;&lt;/script&gt;</span></p>
<p class="p1"><span class="s1">&lt;style&gt;*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;overflow:hidden}#map{height:100vh;width:100%;position:fixed;top:0;left:0;z-index:1}.sidebar{position:fixed;left:0;top:0;width:400px;height:100vh;background:white;box-shadow:2px 0 10px rgba(0,0,0,0.2);z-index:1000;display:flex;flex-direction:column}.comparator-panel{position:fixed;right:0;top:0;width:450px;height:100vh;background:white;box-shadow:-2px 0 10px rgba(0,0,0,0.2);z-index:1001;display:flex;flex-direction:column;transform:translateX(100%);transition:transform .3s}.comparator-panel.open{transform:translateX(0)}.sidebar-scroll{flex:1;overflow-y:auto}.sidebar-scroll::-webkit-scrollbar{width:8px}.sidebar-scroll::-webkit-scrollbar-track{background:#f1f1f1}.sidebar-scroll::-webkit-scrollbar-thumb{background:#888;border-radius:4px}.selected-for-compare{background-color:#dbeafe!important;border-left:4px solid #2563eb!important}@media(max-width:768px){.sidebar{width:100%;height:50vh;top:auto;bottom:0}.comparator-panel{width:100%;height:70vh}#map{height:50vh}}&lt;/style&gt;</span></p>
<p class="p1"><span class="s1">&lt;/head&gt;</span></p>
<p class="p1"><span class="s1">&lt;body&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="map"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div id="root"&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;script type="text/babel"&gt;</span></p>
<p class="p1"><span class="s1">const{useState,useEffect}=React;let map=null,cluster=null,userMark=null;</span></p>
<p class="p1"><span class="s1">const App=()=&gt;{</span></p>
<p class="p1"><span class="s1">const[gas,setGas]=useState([]);</span></p>
<p class="p1"><span class="s1">const[elec,setElec]=useState([]);</span></p>
<p class="p1"><span class="s1">const[items,setItems]=useState([]);</span></p>
<p class="p1"><span class="s1">const[load,setLoad]=useState(!0);</span></p>
<p class="p1"><span class="s1">const[err,setErr]=useState(null);</span></p>
<p class="p1"><span class="s1">const[mode,setMode]=useState('gas');</span></p>
<p class="p1"><span class="s1">const[fuel,setFuel]=useState('Precio Gasolina 95 E5');</span></p>
<p class="p1"><span class="s1">const[search,setSearch]=useState('');</span></p>
<p class="p1"><span class="s1">const[sort,setSort]=useState('price');</span></p>
<p class="p1"><span class="s1">const[loc,setLoc]=useState(null);</span></p>
<p class="p1"><span class="s1">const[showF,setShowF]=useState(!0);</span></p>
<p class="p1"><span class="s1">const[prov,setProv]=useState('');</span></p>
<p class="p1"><span class="s1">const[stats,setStats]=useState({min:0,max:0,avg:0});</span></p>
<p class="p1"><span class="s1">const[mapOk,setMapOk]=useState(!1);</span></p>
<p class="p1"><span class="s1">const[comp,setComp]=useState(!1);</span></p>
<p class="p1"><span class="s1">const[sel,setSel]=useState([]);</span></p>
<p class="p1"><span class="s1">const fuels=['Precio Gasolina 95 E5','Precio Gasolina 98 E5','Precio Gasoleo A','Precio Gasoleo B','Precio Gasoleo Premium'];</span></p>
<p class="p1"><span class="s1">useEffect(()=&gt;{</span></p>
<p class="p1"><span class="s1">if(!map){</span></p>
<p class="p1"><span class="s1">map=L.map('map').setView([40.4168,-3.7038],7);</span></p>
<p class="p1"><span class="s1">L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap',maxZoom:19}).addTo(map);</span></p>
<p class="p1"><span class="s1">cluster=L.markerClusterGroup({maxClusterRadius:50});</span></p>
<p class="p1"><span class="s1">map.addLayer(cluster);</span></p>
<p class="p1"><span class="s1">setTimeout(()=&gt;{map.invalidateSize();setMapOk(!0)},200);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">fetchGas();</span></p>
<p class="p1"><span class="s1">fetchElec();</span></p>
<p class="p1"><span class="s1">getLoc();</span></p>
<p class="p1"><span class="s1">},[]);</span></p>
<p class="p1"><span class="s1">const fetchGas=async()=&gt;{</span></p>
<p class="p1"><span class="s1">try{</span></p>
<p class="p1"><span class="s1">setLoad(!0);</span></p>
<p class="p1"><span class="s1">const r=await fetch('https://sedeaplicaciones.minetur.gob.es/ServiciosRESTCarburantes/PreciosCarburantes/EstacionesTerrestres/');</span></p>
<p class="p1"><span class="s1">const d=await r.json();</span></p>
<p class="p1"><span class="s1">const g=d.ListaEESSPrecio.map(s=&gt;({</span></p>
<p class="p1"><span class="s1">id:'g-'+s.IDEESS,</span></p>
<p class="p1"><span class="s1">type:'gas',</span></p>
<p class="p1"><span class="s1">name:s['R√≥tulo']||'Sin nombre',</span></p>
<p class="p1"><span class="s1">addr:s['Direcci√≥n'],</span></p>
<p class="p1"><span class="s1">town:s['Municipio'],</span></p>
<p class="p1"><span class="s1">prov:s['Provincia'],</span></p>
<p class="p1"><span class="s1">lat:parseFloat(s['Latitud'].replace(',','.')),</span></p>
<p class="p1"><span class="s1">lng:parseFloat(s['Longitud (WGS84)'].replace(',','.')),</span></p>
<p class="p1"><span class="s1">p:{</span></p>
<p class="p1"><span class="s1">'Precio Gasolina 95 E5':parseFloat(s['Precio Gasolina 95 E5']?.replace(',','.'))||null,</span></p>
<p class="p1"><span class="s1">'Precio Gasolina 98 E5':parseFloat(s['Precio Gasolina 98 E5']?.replace(',','.'))||null,</span></p>
<p class="p1"><span class="s1">'Precio Gasoleo A':parseFloat(s['Precio Gasoleo A']?.replace(',','.'))||null,</span></p>
<p class="p1"><span class="s1">'Precio Gasoleo B':parseFloat(s['Precio Gasoleo B']?.replace(',','.'))||null,</span></p>
<p class="p1"><span class="s1">'Precio Gasoleo Premium':parseFloat(s['Precio Gasoleo Premium']?.replace(',','.'))||null</span></p>
<p class="p1"><span class="s1">}}));</span></p>
<p class="p1"><span class="s1">setGas(g);</span></p>
<p class="p1"><span class="s1">setLoad(!1);</span></p>
<p class="p1"><span class="s1">}catch(e){setErr('Error');setLoad(!1)}</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const fetchElec=async()=&gt;{</span></p>
<p class="p1"><span class="s1">try{</span></p>
<p class="p1"><span class="s1">const r=await fetch('https://api.openchargemap.io/v3/poi/?output=json&amp;countrycode=ES&amp;maxresults=2000');</span></p>
<p class="p1"><span class="s1">const d=await r.json();</span></p>
<p class="p1"><span class="s1">const e=d.map(c=&gt;({</span></p>
<p class="p1"><span class="s1">id:'e-'+c.ID,</span></p>
<p class="p1"><span class="s1">type:'elec',</span></p>
<p class="p1"><span class="s1">name:c.AddressInfo?.Title||'Cargador',</span></p>
<p class="p1"><span class="s1">addr:c.AddressInfo?.AddressLine1||'',</span></p>
<p class="p1"><span class="s1">town:c.AddressInfo?.Town||'',</span></p>
<p class="p1"><span class="s1">prov:c.AddressInfo?.StateOrProvince||'',</span></p>
<p class="p1"><span class="s1">lat:c.AddressInfo?.Latitude,</span></p>
<p class="p1"><span class="s1">lng:c.AddressInfo?.Longitude,</span></p>
<p class="p1"><span class="s1">op:c.OperatorInfo?.Title||'?',</span></p>
<p class="p1"><span class="s1">conn:c.Connections||[],</span></p>
<p class="p1"><span class="s1">cost:c.UsageCost||'?'</span></p>
<p class="p1"><span class="s1">}));</span></p>
<p class="p1"><span class="s1">setElec(e);</span></p>
<p class="p1"><span class="s1">}catch(e){console.error(e)}</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const getLoc=()=&gt;{</span></p>
<p class="p1"><span class="s1">if(navigator.geolocation){</span></p>
<p class="p1"><span class="s1">navigator.geolocation.getCurrentPosition(p=&gt;{</span></p>
<p class="p1"><span class="s1">const l={lat:p.coords.latitude,lng:p.coords.longitude};</span></p>
<p class="p1"><span class="s1">setLoc(l);</span></p>
<p class="p1"><span class="s1">if(map){</span></p>
<p class="p1"><span class="s1">map.setView([l.lat,l.lng],11);</span></p>
<p class="p1"><span class="s1">if(userMark)userMark.remove();</span></p>
<p class="p1"><span class="s1">const ico=L.divIcon({html:'&lt;div style="background:#3b82f6;width:20px;height:20px;border-radius:50%;border:3px solid white;box-shadow:0 2px 4px rgba(0,0,0,0.3)"&gt;&lt;/div&gt;',className:'',iconSize:[20,20],iconAnchor:[10,10]});</span></p>
<p class="p1"><span class="s1">userMark=L.marker([l.lat,l.lng],{icon:ico}).bindPopup('üìç Tu ubicaci√≥n').addTo(map);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const dist=(a,b,c,d)=&gt;{</span></p>
<p class="p1"><span class="s1">const R=6371,x=(c-a)*Math.PI/180,y=(d-b)*Math.PI/180,z=Math.sin(x/2)*Math.sin(x/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);</span></p>
<p class="p1"><span class="s1">return R*2*Math.atan2(Math.sqrt(z),Math.sqrt(1-z));</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">useEffect(()=&gt;{</span></p>
<p class="p1"><span class="s1">if(gas.length&gt;0){</span></p>
<p class="p1"><span class="s1">const pr=gas.map(s=&gt;s.p[fuel]).filter(p=&gt;p&gt;0);</span></p>
<p class="p1"><span class="s1">if(pr.length&gt;0)setStats({min:Math.min(...pr),max:Math.max(...pr),avg:pr.reduce((a,b)=&gt;a+b,0)/pr.length});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">},[gas,fuel]);</span></p>
<p class="p1"><span class="s1">useEffect(()=&gt;{</span></p>
<p class="p1"><span class="s1">let res=[];</span></p>
<p class="p1"><span class="s1">if(mode==='gas'||mode==='both'){</span></p>
<p class="p1"><span class="s1">let g=[...gas];</span></p>
<p class="p1"><span class="s1">if(search)g=g.filter(s=&gt;s.town?.toLowerCase().includes(search.toLowerCase())||s.prov?.toLowerCase().includes(search.toLowerCase())||s.name?.toLowerCase().includes(search.toLowerCase()));</span></p>
<p class="p1"><span class="s1">if(prov)g=g.filter(s=&gt;s.prov===prov);</span></p>
<p class="p1"><span class="s1">g=g.filter(s=&gt;s.p[fuel]&gt;0);</span></p>
<p class="p1"><span class="s1">res=res.concat(g);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if(mode==='elec'||mode==='both'){</span></p>
<p class="p1"><span class="s1">let e=[...elec];</span></p>
<p class="p1"><span class="s1">if(search)e=e.filter(c=&gt;c.town?.toLowerCase().includes(search.toLowerCase())||c.prov?.toLowerCase().includes(search.toLowerCase())||c.name?.toLowerCase().includes(search.toLowerCase()));</span></p>
<p class="p1"><span class="s1">if(prov)e=e.filter(c=&gt;c.prov===prov);</span></p>
<p class="p1"><span class="s1">res=res.concat(e);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">if(sort==='price'&amp;&amp;mode!=='elec')res.sort((a,b)=&gt;(a.p?.[fuel]||999)-(b.p?.[fuel]||999));</span></p>
<p class="p1"><span class="s1">else if(sort==='distance'&amp;&amp;loc)res=res.map(i=&gt;({...i,distance:dist(loc.lat,loc.lng,i.lat,i.lng)})).sort((a,b)=&gt;a.distance-b.distance);</span></p>
<p class="p1"><span class="s1">setItems(res.slice(0,1000));</span></p>
<p class="p1"><span class="s1">},[gas,elec,mode,search,fuel,sort,prov,loc]);</span></p>
<p class="p1"><span class="s1">const getCol=p=&gt;{</span></p>
<p class="p1"><span class="s1">if(!p||!stats.min||!stats.max)return'#6b7280';</span></p>
<p class="p1"><span class="s1">const r=stats.max-stats.min,l=stats.min+r*0.33,h=stats.min+r*0.66;</span></p>
<p class="p1"><span class="s1">return p&lt;=l?'#10b981':p&lt;=h?'#f59e0b':'#ef4444';</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">useEffect(()=&gt;{</span></p>
<p class="p1"><span class="s1">if(!map||!cluster||!mapOk)return;</span></p>
<p class="p1"><span class="s1">cluster.clearLayers();</span></p>
<p class="p1"><span class="s1">items.forEach(i=&gt;{</span></p>
<p class="p1"><span class="s1">if(i.lat&amp;&amp;i.lng&amp;&amp;!isNaN(i.lat)&amp;&amp;!isNaN(i.lng)){</span></p>
<p class="p1"><span class="s1">const isG=i.type==='gas';</span></p>
<p class="p1"><span class="s1">const col=isG?getCol(i.p?.[fuel]):'#10b981';</span></p>
<p class="p1"><span class="s1">const ico=L.divIcon({</span></p>
<p class="p1"><span class="s1">html:isG?`&lt;svg width="32" height="42"&gt;&lt;path d="M16 0C7.2 0 0 7.2 0 16c0 11 16 26 16 26s16-15 16-26c0-8.8-7.2-16-16-16z" fill="${col}"/&gt;&lt;circle cx="16" cy="16" r="6" fill="white"/&gt;&lt;/svg&gt;`:`&lt;svg width="32" height="42"&gt;&lt;path d="M16 0C7.2 0 0 7.2 0 16c0 11 16 26 16 26s16-15 16-26c0-8.8-7.2-16-16-16z" fill="#10b981"/&gt;&lt;path d="M12 10l8 6-8 6V10z" fill="white"/&gt;&lt;/svg&gt;`,</span></p>
<p class="p1"><span class="s1">className:'',iconSize:[32,42],iconAnchor:[16,42],popupAnchor:[0,-42]</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">const m=L.marker([i.lat,i.lng],{icon:ico});</span></p>
<p class="p1"><span class="s1">if(isG){</span></p>
<p class="p1"><span class="s1">m.bindPopup(`&lt;div style="min-width:220px"&gt;&lt;strong&gt;${i.name}&lt;/strong&gt;&lt;br/&gt;&lt;div style="font-size:11px;color:#666;margin-top:4px"&gt;‚õΩ Gasolinera&lt;br/&gt;üìç ${i.addr}&lt;br/&gt;${i.town}, ${i.prov}&lt;/div&gt;&lt;div style="margin-top:8px;padding:8px;background:${col}15;border-radius:6px"&gt;&lt;div style="font-size:24px;font-weight:bold;color:${col}"&gt;${i.p[fuel]?.toFixed(3)} ‚Ç¨/L&lt;/div&gt;&lt;/div&gt;${i.distance?`&lt;div style="font-size:11px;margin-top:4px"&gt;üìç ${i.distance.toFixed(1)} km&lt;/div&gt;`:''}&lt;/div&gt;`);</span></p>
<p class="p1"><span class="s1">}else{</span></p>
<p class="p1"><span class="s1">const cn=i.conn.slice(0,2).map(c=&gt;`${c.ConnectionType?.Title||'?'} ${c.PowerKW||'?'}kW`).join('&lt;br/&gt;');</span></p>
<p class="p1"><span class="s1">m.bindPopup(`&lt;div style="min-width:220px"&gt;&lt;strong&gt;${i.name}&lt;/strong&gt;&lt;br/&gt;&lt;div style="font-size:11px;color:#666;margin-top:4px"&gt;üîå Cargador&lt;br/&gt;üìç ${i.addr}&lt;br/&gt;${i.town}, ${i.prov}&lt;/div&gt;&lt;div style="margin-top:8px;padding:8px;background:#10b98115;border-radius:6px"&gt;&lt;div style="font-size:11px"&gt;${cn||'Sin info'}&lt;/div&gt;&lt;div style="font-size:11px;margin-top:4px"&gt;Op: ${i.op}&lt;/div&gt;&lt;/div&gt;${i.distance?`&lt;div style="font-size:11px;margin-top:4px"&gt;üìç ${i.distance.toFixed(1)} km&lt;/div&gt;`:''}&lt;/div&gt;`);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">cluster.addLayer(m);</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">});</span></p>
<p class="p1"><span class="s1">},[items,fuel,stats,mapOk,mode]);</span></p>
<p class="p1"><span class="s1">const center=i=&gt;{</span></p>
<p class="p1"><span class="s1">if(map&amp;&amp;i.lat&amp;&amp;i.lng){</span></p>
<p class="p1"><span class="s1">map.setView([i.lat,i.lng],16);</span></p>
<p class="p1"><span class="s1">cluster.eachLayer(l=&gt;{if(l.getLatLng().lat===i.lat&amp;&amp;l.getLatLng().lng===i.lng)l.openPopup()});</span></p>
<p class="p1"><span class="s1">}</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const nav=i=&gt;{</span></p>
<p class="p1"><span class="s1">const u=loc?`https://www.google.com/maps/dir/${loc.lat},${loc.lng}/${i.lat},${i.lng}`:`https://www.google.com/maps/dir/?api=1&amp;destination=${i.lat},${i.lng}`;</span></p>
<p class="p1"><span class="s1">window.open(u,'_blank');</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const badge=p=&gt;{</span></p>
<p class="p1"><span class="s1">if(!p||!stats.min)return{t:'N/D',c:'bg-gray-100 text-gray-800'};</span></p>
<p class="p1"><span class="s1">const r=stats.max-stats.min,l=stats.min+r*0.33,h=stats.min+r*0.66;</span></p>
<p class="p1"><span class="s1">return p&lt;=l?{t:'üü¢ Bajo',c:'bg-green-100 text-green-800'}:p&lt;=h?{t:'üü° Medio',c:'bg-yellow-100 text-yellow-800'}:{t:'üî¥ Alto',c:'bg-red-100 text-red-800'};</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const togComp=()=&gt;{if(comp)setSel([]);setComp(!comp)};</span></p>
<p class="p1"><span class="s1">const togSel=s=&gt;{</span></p>
<p class="p1"><span class="s1">if(s.type!=='gas')return;</span></p>
<p class="p1"><span class="s1">if(sel.find(x=&gt;x.id===s.id))setSel(sel.filter(x=&gt;x.id!==s.id));</span></p>
<p class="p1"><span class="s1">else if(sel.length&lt;2)setSel([...sel,s]);</span></p>
<p class="p1"><span class="s1">else setSel([sel[1],s]);</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const isSel=s=&gt;sel.find(x=&gt;x.id===s.id);</span></p>
<p class="p1"><span class="s1">const provs=[...new Set([...gas.map(s=&gt;s.prov),...elec.map(c=&gt;c.prov)])].filter(Boolean).sort();</span></p>
<p class="p1"><span class="s1">if(load)return&lt;div className="sidebar"&gt;&lt;div className="h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100"&gt;&lt;div className="text-center"&gt;&lt;div className="text-6xl mb-4 animate-pulse"&gt;‚õΩ&lt;/div&gt;&lt;p className="text-xl text-gray-700"&gt;Cargando...&lt;/p&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;;</span></p>
<p class="p1"><span class="s1">if(err)return&lt;div className="sidebar"&gt;&lt;div className="h-full flex items-center justify-center bg-gradient-to-br from-blue-50 to-indigo-100"&gt;&lt;div className="bg-white p-8 rounded-lg shadow-lg text-center"&gt;&lt;p className="text-red-600 mb-4"&gt;{err}&lt;/p&gt;&lt;button onClick={fetchGas} className="bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700"&gt;Reintentar&lt;/button&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;;</span></p>
<p class="p1"><span class="s1">return&lt;&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="sidebar"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="bg-gradient-to-r from-blue-600 to-indigo-600 text-white p-4"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex items-center justify-between mb-3"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex items-center gap-2"&gt;&lt;span className="text-2xl"&gt;‚õΩ&lt;/span&gt;&lt;h1 className="text-xl font-bold"&gt;Espa√±a&lt;/h1&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">{mode==='gas'&amp;&amp;&lt;button onClick={togComp} className={`px-3 py-1.5 rounded text-sm font-medium ${comp?'bg-white text-blue-600':'bg-blue-700 hover:bg-blue-800'}`}&gt;{comp?'‚úì Comparando':'‚öñÔ∏è Comparar'}&lt;/button&gt;}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex gap-2 mb-2"&gt;</span></p>
<p class="p1"><span class="s1">&lt;button onClick={()=&gt;setMode('gas')} className={`flex-1 px-3 py-1.5 rounded text-sm font-medium ${mode==='gas'?'bg-white text-blue-600':'bg-blue-700 hover:bg-blue-800'}`}&gt;‚õΩ Gas&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button onClick={()=&gt;setMode('elec')} className={`flex-1 px-3 py-1.5 rounded text-sm font-medium ${mode==='elec'?'bg-white text-blue-600':'bg-blue-700 hover:bg-blue-800'}`}&gt;üîå Elec&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;button onClick={()=&gt;setMode('both')} className={`flex-1 px-3 py-1.5 rounded text-sm font-medium ${mode==='both'?'bg-white text-blue-600':'bg-blue-700 hover:bg-blue-800'}`}&gt;‚ö° Ambos&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="text-sm opacity-90"&gt;{items.length} puntos&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">{stats.min&gt;0&amp;&amp;mode!=='elec'&amp;&amp;&lt;div className="mt-2 text-xs opacity-90"&gt;&lt;div&gt;üí∞ {stats.min.toFixed(3)}‚Ç¨ - {stats.max.toFixed(3)}‚Ç¨&lt;/div&gt;&lt;div&gt;üìä Media: {stats.avg.toFixed(3)}‚Ç¨/L&lt;/div&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">{comp&amp;&amp;&lt;div className="mt-2 text-xs bg-blue-700 bg-opacity-50 p-2 rounded"&gt;‚ÑπÔ∏è Selecciona 2 ({sel.length}/2)&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="p-4 border-b"&gt;</span></p>
<p class="p1"><span class="s1">&lt;input type="text" placeholder="üîç Buscar..." value={search} onChange={e=&gt;setSearch(e.target.value)} className="w-full px-3 py-2 border rounded-lg focus:ring-2 focus:ring-blue-500 focus:outline-none text-sm mb-3"/&gt;</span></p>
<p class="p1"><span class="s1">&lt;button onClick={()=&gt;setShowF(!showF)} className="text-blue-600 text-sm font-medium mb-2"&gt;{showF?'‚ñ≤':'‚ñº'} Filtros&lt;/button&gt;</span></p>
<p class="p1"><span class="s1">{showF&amp;&amp;&lt;div className="space-y-3"&gt;</span></p>
<p class="p1"><span class="s1">{mode!=='elec'&amp;&amp;&lt;div&gt;&lt;label className="block text-xs font-medium mb-1"&gt;Combustible&lt;/label&gt;&lt;select value={fuel} onChange={e=&gt;setFuel(e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"&gt;{fuels.map(f=&gt;&lt;option key={f} value={f}&gt;{f.replace('Precio ','')}&lt;/option&gt;)}&lt;/select&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">&lt;div&gt;&lt;label className="block text-xs font-medium mb-1"&gt;Provincia&lt;/label&gt;&lt;select value={prov} onChange={e=&gt;setProv(e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"&gt;&lt;option value=""&gt;Todas&lt;/option&gt;{provs.map(p=&gt;&lt;option key={p} value={p}&gt;{p}&lt;/option&gt;)}&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div&gt;&lt;label className="block text-xs font-medium mb-1"&gt;Ordenar&lt;/label&gt;&lt;select value={sort} onChange={e=&gt;setSort(e.target.value)} className="w-full px-3 py-2 border rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none"&gt;&lt;option value="price"&gt;Precio&lt;/option&gt;{loc&amp;&amp;&lt;option value="distance"&gt;Distancia&lt;/option&gt;}&lt;/select&gt;&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">{mode!=='elec'&amp;&amp;&lt;div className="px-4 py-2 bg-gray-50 border-b text-xs flex gap-3"&gt;&lt;span className="flex items-center gap-1"&gt;&lt;span className="w-3 h-3 rounded-full bg-green-500"&gt;&lt;/span&gt;Bajo&lt;/span&gt;&lt;span className="flex items-center gap-1"&gt;&lt;span className="w-3 h-3 rounded-full bg-yellow-500"&gt;&lt;/span&gt;Medio&lt;/span&gt;&lt;span className="flex items-center gap-1"&gt;&lt;span className="w-3 h-3 rounded-full bg-red-500"&gt;&lt;/span&gt;Alto&lt;/span&gt;&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">&lt;div className="sidebar-scroll"&gt;</span></p>
<p class="p1"><span class="s1">{items.map(i=&gt;{</span></p>
<p class="p1"><span class="s1">const isG=i.type==='gas';</span></p>
<p class="p1"><span class="s1">const b=isG?badge(i.p?.[fuel]):{t:'üîå Cargador',c:'bg-green-100 text-green-800'};</span></p>
<p class="p1"><span class="s1">const col=isG?getCol(i.p?.[fuel]):'#10b981';</span></p>
<p class="p1"><span class="s1">const selected=isSel(i);</span></p>
<p class="p1"><span class="s1">return&lt;div key={i.id} onClick={()=&gt;!comp&amp;&amp;center(i)} className={`p-4 border-b hover:bg-blue-50 transition ${!comp&amp;&amp;'cursor-pointer'} ${selected?'selected-for-compare':''}`}&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex justify-between items-start mb-2"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex-1 pr-2"&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="text-xs text-gray-500 mb-1"&gt;{isG?'‚õΩ':'üîå'}&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;h3 className="font-semibold text-sm mb-1"&gt;{i.name}&lt;/h3&gt;</span></p>
<p class="p1"><span class="s1">&lt;p className="text-xs text-gray-600"&gt;{i.town}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">&lt;p className="text-xs text-gray-500"&gt;{i.prov}&lt;/p&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="text-right"&gt;</span></p>
<p class="p1"><span class="s1">{isG?&lt;&gt;&lt;div className="text-xl font-bold" style={{color:col}}&gt;{i.p[fuel]?.toFixed(3)}&lt;/div&gt;&lt;div className="text-xs text-gray-500"&gt;‚Ç¨/L&lt;/div&gt;&lt;/&gt;:&lt;div className="text-sm text-green-600 font-semibold"&gt;{i.conn[0]?.PowerKW?`${i.conn[0].PowerKW}kW`:'Cargador'}&lt;/div&gt;}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="flex items-center gap-2 mt-2"&gt;</span></p>
<p class="p1"><span class="s1">{i.distance&amp;&amp;&lt;span className="text-xs text-gray-500"&gt;üìç {i.distance.toFixed(1)} km&lt;/span&gt;}</span></p>
<p class="p1"><span class="s1">&lt;span className={`text-xs px-2 py-1 rounded-full ${b.c}`}&gt;{b.t}&lt;/span&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;div className="mt-2 flex gap-2"&gt;</span></p>
<p class="p1"><span class="s1">{comp&amp;&amp;isG&amp;&amp;&lt;button onClick={()=&gt;togSel(i)} className={`flex-1 px-3 py-1.5 rounded text-xs font-medium ${selected?'bg-blue-600 text-white':'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}&gt;{selected?'‚úì Seleccionada':'Seleccionar'}&lt;/button&gt;}</span></p>
<p class="p1"><span class="s1">{!comp&amp;&amp;loc&amp;&amp;&lt;button onClick={e=&gt;{e.stopPropagation();nav(i)}} className="flex-1 bg-blue-600 text-white px-3 py-1.5 rounded text-xs hover:bg-blue-700"&gt;üß≠ Ir&lt;/button&gt;}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;})}</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;/div&gt;</span></p>
<p class="p1"><span class="s1">&lt;Comp stations={sel} fuel={fuel} loc={loc} onClose={()=&gt;setSel([])}/&gt;</span></p>
<p class="p1"><span class="s1">&lt;/&gt;;</span></p>
<p class="p1"><span class="s1">};</span></p>
<p class="p1"><span class="s1">const Comp=({stations,fuel,loc,onClose})=&gt;{</span></p>
<p class="p1"><span class="s1">const[amt,setAmt]=useState(50);</span></p>
<p class="p1"><span class="s1">const[cons,setCons]=useState(6);</span></p>
<p class="p1"><span class="s1">if(stations.length!==2)return null;</span></p>
<p class="p1"><span class="s1">const[s1,s2]=stations;</span></p>
<p class="p1"><span class="s1">const p1=s1.p[fuel],p2=s2.p[fuel];</span></p>
<p class="p1"><span class="s1">const l1=amt/p1,l2=amt/p2;</span></p>
<p class="p1"><span class="s1">const lDiff=Math.abs(l2-l1);</span></p>
<p class="p1"><span class="s1">const kmDiff=lDiff/cons*100;</span></p>
<p class="p1"><span class="s1">const sav=lDiff*Math.min(p1,p2);</span></p>
<p class="p1"><span class="s1">const dist2=(a,b,c,d)=&gt;{const R=6371,x=(c-a)*Math.PI/180,y=(d-b)*Math.PI/180,z=Math.sin(x/2)*Math.sin(x/2)+Math.cos(a*Math.PI/180)*Math.cos(c*Math.PI/180)*Math.sin(y/2)*Math.sin(y/2);return R*2*Math.atan2(Math.sqrt(z),Math.sqrt(1-z))};</span></p>
<p class="p1"><span class="s1">const dBet=loc&amp;&amp;s1.lat&amp;&amp;s2.lat?Math.abs(dist2(loc.lat,loc.lng,s1.lat,s1.lng)-dist2(loc.lat,loc.lng,s2.lat,s2.lng)):0;</span></p>
<p class="p1"><span class="s1">const extra=dBet/100*cons*Math.min(p1,p2);</span></p>
<p class="p1"><span class="s1">const worth=sav&gt;extra;</span></p>
<p class="p1"><span class="s1">return&lt;div className="comparator-panel open"&gt;&lt;div className="bg-gradient-to-r from-purple-600 to-blue-600 text-white p-4"&gt;&lt;div className="flex items-center justify-between mb-2"&gt;&lt;h2 className="text-xl font-bold"&gt;‚öñÔ∏è Comparador&lt;/h2&gt;&lt;button onClick={onClose} className="text-2xl hover:bg-white hover:bg-opacity-20 w-8 h-8 rounded"&gt;√ó&lt;/button&gt;&lt;/div&gt;&lt;p className="text-sm opacity-90"&gt;Compara y ahorra&lt;/p&gt;&lt;/div&gt;&lt;div className="flex-1 overflow-y-auto p-4 space-y-4"&gt;&lt;div className="bg-white rounded-lg shadow-md p-4"&gt;&lt;h3 className="font-bold mb-3 text-gray-800"&gt;üí∂ Config&lt;/h3&gt;&lt;div className="mb-4"&gt;&lt;label className="block text-sm font-medium text-gray-700 mb-2"&gt;Dinero: {amt}‚Ç¨&lt;/label&gt;&lt;input type="range" min="10" max="100" step="5" value={amt} onChange={e=&gt;setAmt(Number(e.target.value))} className="w-full"/&gt;&lt;div className="flex justify-between text-xs text-gray-500 mt-1"&gt;&lt;span&gt;10‚Ç¨&lt;/span&gt;&lt;span&gt;100‚Ç¨&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;label className="block text-sm font-medium text-gray-700 mb-2"&gt;Consumo: {cons} L/100km&lt;/label&gt;&lt;input type="range" min="4" max="15" step="0.5" value={cons} onChange={e=&gt;setCons(Number(e.target.value))} className="w-full"/&gt;&lt;div className="flex justify-between text-xs text-gray-500 mt-1"&gt;&lt;span&gt;4 L&lt;/span&gt;&lt;span&gt;15 L&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div className="grid grid-cols-2 gap-3"&gt;&lt;div className={`bg-white rounded-lg shadow-md p-4 ${p1&lt;p2?'ring-2 ring-green-500':''}`}&gt;&lt;div className="text-xs font-semibold text-gray-500 mb-2"&gt;{p1&lt;p2?'üèÜ M√ÅS BARATA':'M√ÅS CARA'}&lt;/div&gt;&lt;h4 className="font-bold text-sm mb-2 text-gray-800"&gt;{s1.name}&lt;/h4&gt;&lt;div className="text-2xl font-bold text-blue-600 mb-1"&gt;{p1.toFixed(3)}‚Ç¨&lt;/div&gt;&lt;div className="text-xs text-gray-500 mb-3"&gt;por litro&lt;/div&gt;&lt;div className="space-y-2 text-sm"&gt;&lt;div className="flex justify-between"&gt;&lt;span className="text-gray-600"&gt;Litros:&lt;/span&gt;&lt;span className="font-semibold"&gt;{l1.toFixed(2)} L&lt;/span&gt;&lt;/div&gt;&lt;div className="flex justify-between"&gt;&lt;span className="text-gray-600"&gt;Autonom√≠a:&lt;/span&gt;&lt;span className="font-semibold"&gt;{(l1/cons*100).toFixed(0)} km&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div className={`bg-white rounded-lg shadow-md p-4 ${p2&lt;p1?'ring-2 ring-green-500':''}`}&gt;&lt;div className="text-xs font-semibold text-gray-500 mb-2"&gt;{p2&lt;p1?'üèÜ M√ÅS BARATA':'M√ÅS CARA'}&lt;/div&gt;&lt;h4 className="font-bold text-sm mb-2 text-gray-800"&gt;{s2.name}&lt;/h4&gt;&lt;div className="text-2xl font-bold text-blue-600 mb-1"&gt;{p2.toFixed(3)}‚Ç¨&lt;/div&gt;&lt;div className="text-xs text-gray-500 mb-3"&gt;por litro&lt;/div&gt;&lt;div className="space-y-2 text-sm"&gt;&lt;div className="flex justify-between"&gt;&lt;span className="text-gray-600"&gt;Litros:&lt;/span&gt;&lt;span className="font-semibold"&gt;{l2.toFixed(2)} L&lt;/span&gt;&lt;/div&gt;&lt;div className="flex justify-between"&gt;&lt;span className="text-gray-600"&gt;Autonom√≠a:&lt;/span&gt;&lt;span className="font-semibold"&gt;{(l2/cons*100).toFixed(0)} km&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div className="bg-gradient-to-r from-green-500 to-emerald-600 text-white rounded-lg shadow-lg p-4"&gt;&lt;h3 className="font-bold mb-3 flex items-center gap-2"&gt;&lt;span className="text-2xl"&gt;üí∞&lt;/span&gt;Diferencia&lt;/h3&gt;&lt;div className="grid grid-cols-2 gap-4"&gt;&lt;div&gt;&lt;div className="text-xs opacity-90 mb-1"&gt;Litros extra&lt;/div&gt;&lt;div className="text-2xl font-bold"&gt;{lDiff.toFixed(2)} L&lt;/div&gt;&lt;/div&gt;&lt;div&gt;</span><span class="s2">&lt; div className="text-xs opacity-90 mb-1"&gt;Km extra&lt;/div&gt;&lt;div className="text-2xl font-bold"&gt;{kmDiff.toFixed(0)} km&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;div className="mt-3 pt-3 border-t border-white border-opacity-30"&gt;&lt;div className="text-xs opacity-90 mb-1"&gt;Ahorro total&lt;/div&gt;&lt;div className="text-3xl font-bold"&gt;{sav.toFixed(2)}‚Ç¨&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;{loc&amp;&amp;dBet&gt;0&amp;&amp;&lt;div className={</span><span class="s3">rounded-lg shadow-lg p-4 ${worth?'bg-gradient-to-r from-blue-500 to-cyan-600 text-white':'bg-gradient-to-r from-orange-500 to-red-600 text-white'}</span><span class="s2">}&gt;&lt;h3 className="font-bold mb-3 flex items-center gap-2"&gt;&lt;span className="text-2xl"&gt;üéØ&lt;/span&gt;¬øVale la pena?&lt;/h3&gt;&lt;div className="space-y-2 text-sm"&gt;&lt;div className="flex justify-between"&gt;&lt;span className="opacity-90"&gt;Dist extra:&lt;/span&gt;&lt;span className="font-bold"&gt;{dBet.toFixed(1)} km&lt;/span&gt;&lt;/div&gt;&lt;div className="flex justify-between"&gt;&lt;span className="opacity-90"&gt;Coste desv√≠o:&lt;/span&gt;&lt;span className="font-bold"&gt;{extra.toFixed(2)}‚Ç¨&lt;/span&gt;&lt;/div&gt;&lt;div className="flex justify-between"&gt;&lt;span className="opacity-90"&gt;Ahorro:&lt;/span&gt;&lt;span className="font-bold"&gt;{sav.toFixed(2)}‚Ç¨&lt;/span&gt;&lt;/div&gt;&lt;/div&gt;&lt;div className="mt-3 pt-3 border-t border-white border-opacity-30"&gt;&lt;div className="text-lg font-bold text-center"&gt;{worth?&lt;&gt;‚úÖ S√ç VALE&lt;div className="text-sm font-normal opacity-90 mt-1"&gt;Ahorras {(sav-extra).toFixed(2)}‚Ç¨ netos&lt;/div&gt;&lt;/&gt;:&lt;&gt;‚õî NO&lt;div className="text-sm font-normal opacity-90 mt-1"&gt;Pierdes {(extra-sav).toFixed(2)}‚Ç¨&lt;/div&gt;&lt;/&gt;}&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;}&lt;/div&gt;&lt;/div&gt; }; ReactDOM.render(&lt;App/&gt;,document.getElementById('root')); &lt;/script&gt;</span></p>
<p class="p2"><span class="s1">&lt;/body&gt; &lt;/html&gt; ```</span></p>
<p class="p3"><span class="s1"></span><br></p>
</body>
</html>
